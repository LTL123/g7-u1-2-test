<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>教师测试页 / Teacher Test</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    body { padding: 16px; }
    table { width: 100%; border-collapse: collapse; }
    th, td { border: 1px solid #ddd; padding: 8px; vertical-align: top; }
    th { background: #f7f7f7; }
    .ok { color: #0a7; font-weight: 600; }
    .fail { color: #d22; font-weight: 600; }
    .warn { color: #d90; font-weight: 600; }
    .expr-tex { font-size: 14px; color: #333; }
    .controls { margin-bottom: 12px; }
    .small { font-size: 12px; color: #666; }
    .sticky { position: sticky; top: 0; background: #fff; z-index: 2; padding: 8px 0; border-bottom: 1px solid #eee; }
  </style>
  <!-- MathJax for TeX rendering -->
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" async></script>
  <!-- math.js for expression evaluation -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.min.js"></script>
</head>
<body>
  <div class="sticky">
    <h1>教师测试页 / Teacher Test</h1>
    <div class="controls">
      <button id="auto-check-btn">自动验证全部题目 / Auto-Verify All</button>
      <span id="summary" class="small"></span>
    </div>
  </div>

  <table id="questions-table">
    <thead>
      <tr>
        <th>ID</th>
        <th>技能</th>
        <th>难度</th>
        <th>题目</th>
        <th>类型</th>
        <th>期望答案</th>
        <th>教师输入</th>
        <th>测试结果</th>
      </tr>
    </thead>
    <tbody id="questions-tbody"></tbody>
  </table>

<script>
// --- Evaluation helpers (mirror quiz logic) ---
function parseNumeric(str) {
  const s = (str || '').toString().trim();
  if (!s) return NaN;
  if (/^[-]?\d+(?:\.\d+)?$/.test(s)) return Number(s);
  const m = s.match(/^\s*([-]?\d+)\s*\/\s*([-]?\d+)\s*$/);
  if (m) {
    const a = Number(m[1]); const b = Number(m[2]);
    if (b === 0) return NaN; return a / b;
  }
  return NaN;
}
function nearlyEqual(a, b, tol = 1e-3) { return Math.abs(a - b) <= tol; }
function extractVars(expr) {
  const set = new Set();
  const m = (expr || '').match(/[a-zA-Z]/g);
  (m||[]).forEach(ch => set.add(ch));
  return Array.from(set);
}
function normalizeExprForEval(s) {
  if (!s) return '';
  let t = s.replace(/\s+/g, '');
  t = t.replace(/−/g, '-');
  t = t.replace(/([0-9])([a-zA-Z])/g, '$1*$2');
  t = t.replace(/([a-zA-Z])([a-zA-Z])/g, '$1*$2');
  t = t.replace(/([a-zA-Z])(\()/g, '$1*$2');
  t = t.replace(/([0-9])(\()/g, '$1*$2');
  t = t.replace(/(\))([a-zA-Z0-9])/g, '$1*$2');
  t = t.replace(/(\))(\()/g, '$1*$2');
  return t;
}
function exprEquivalent(userExpr, expectedList) {
  try {
    const cleanUser = normalizeExprForEval(userExpr || '');
    const userVars = extractVars(cleanUser);
    const testVals = [-3,-2,-1,1,2,3];
    for (const exp of expectedList) {
      const cleanExp = normalizeExprForEval(exp || '');
      const expVars = extractVars(cleanExp);
      const vars = Array.from(new Set([...userVars, ...expVars]));
      let allOk = true;
      for (let i=0; i<8; i++) {
        const scope = {};
        vars.forEach(v => { scope[v] = testVals[(Math.floor(Math.random()*testVals.length))]; });
        const u = math.evaluate(cleanUser, scope);
        const e = math.evaluate(cleanExp, scope);
        if (!nearlyEqual(Number(u), Number(e))) { allOk = false; break; }
      }
      if (allOk) return true;
    }
    return false;
  } catch (e) { return false; }
}
function evaluate(raw, q) {
  if (q.type === 'numeric') {
    const userVal = parseNumeric(raw);
    if (isNaN(userVal)) return { ok:false, reason:'答案需为数字或分数（如 3/4）', expected: q.answerNum, given: raw };
    const ok = nearlyEqual(userVal, q.answerNum);
    return { ok, expected: q.answerNum, given: userVal };
  } else {
    const s = (raw||'').toString().trim();
    const expListRaw = q.answers || q.answer || [];
    const expList = Array.isArray(expListRaw) ? expListRaw : [expListRaw];
    const ok = exprEquivalent(s, expList);
    const expectedFirst = Array.isArray(expList) ? (expList[0] || '') : expList;
    return { ok, expected: expectedFirst, given: raw };
  }
}
const DIFF_LABEL = { 1: '容易 / Easy', 2: '中等 / Medium', 3: '较难 / Hard' };
const SKILL_NAMES = {
  1: '正负数与零 / Positive & Negative & Zero',
  2: '有理数运算 / Rational Operations',
  3: '用字母表示数 / Letters as Numbers',
  4: '整式合并与化简 / Polynomials Simplify',
  5: '一元一次方程 / Linear Eq (1 var)',
  6: '二元一次方程组 / Linear System (2 vars)',
  7: '方程解决实际问题 / Equations in Word Problems'
};
// --- Copy of QUESTIONS (from main.js) ---
const QUESTIONS = [
  { id: '1-e-1', skill: 1, difficulty: 1, prompt: '气温下降5度，用正负数表示（如 -5）。', type: 'numeric', answerNum: -5 },
  { id: '1-m-1', skill: 1, difficulty: 2, prompt: '比较 -3 和 2 的大小，输入较大的数。', type: 'numeric', answerNum: 2 },
  { id: '1-h-1', skill: 1, difficulty: 3, prompt: '在数轴上，-0.5 与 0.3 哪个更接近0？输入该数。', type: 'numeric', answerNum: 0.3 },
  { id: '2-e-1', skill: 2, difficulty: 1, prompt: '计算 1/2 + 1/3 的值（可填分数或小数）。', type: 'numeric', answerNum: 5/6 },
  { id: '2-m-1', skill: 2, difficulty: 2, prompt: '计算 -3/4 - 1/8 的值。', type: 'numeric', answerNum: -7/8 },
  { id: '2-h-1', skill: 2, difficulty: 3, prompt: '计算 2.5 × (-0.8) 的值。', type: 'numeric', answerNum: -2.0 },
  { id: '3-e-1', skill: 3, difficulty: 1, prompt: '用字母表示：一个数 x 增加 5。', type: 'expr', answers: ['x+5', '5+x'] },
  { id: '3-m-1', skill: 3, difficulty: 2, prompt: '用字母表示：y 的 3 倍减去 2。', type: 'expr', answers: ['3y-2', '3*y-2'] },
  { id: '3-h-1', skill: 3, difficulty: 3, prompt: '用字母表示：a 与 b 的和的平方。', type: 'expr', answers: ['(a+b)^2', 'a^2+2ab+b^2'] },
  { id: '4-e-1', skill: 4, difficulty: 1, prompt: '化简：2x + 3x。', type: 'expr', answers: ['5x'] },
  { id: '4-m-1', skill: 4, difficulty: 2, prompt: '化简：x^2 + 2x + x^2。', type: 'expr', answers: ['2x^2+2x'] },
  { id: '4-h-1', skill: 4, difficulty: 3, prompt: '合并同类项：3a^2b + 2ab^2 - a^2b。', type: 'expr', answer:['2a^2b+2ab^2'] },
  { id: '5-e-1', skill: 5, difficulty: 1, prompt: '解方程：x + 5 = 12，输入 x 的值。', type: 'numeric', answerNum: 7 },
  { id: '5-m-1', skill: 5, difficulty: 2, prompt: '解方程：2x - 3 = 5，输入 x 的值。', type: 'numeric', answerNum: 4 },
  { id: '5-h-1', skill: 5, difficulty: 3, prompt: '解方程：3(x - 2) = 12，输入 x 的值。', type: 'numeric', answerNum: 6 },
  { id: '6-e-1', skill: 6, difficulty: 1, prompt: '解方程组：x + y = 5，x - y = 1。求 x 的值。', type: 'numeric', answerNum: 3 },
  { id: '6-m-1', skill: 6, difficulty: 2, prompt: '解方程组：2x + y = 7，x + 2y = 8。求 x 的值。', type: 'numeric', answerNum: 2 },
  { id: '6-h-1', skill: 6, difficulty: 3, prompt: '解方程组：x + 3y = 10，2x - y = 1。求 x 的值。', type: 'numeric', answerNum: 13/7 },
  { id: '7-e-1', skill: 7, difficulty: 1, prompt: '一桶水每分钟流出 3 升，初始有 15 升。多少分钟流完？', type: 'numeric', answerNum: 5 },
  { id: '7-m-1', skill: 7, difficulty: 2, prompt: '成人票 30 元，学生票 20 元，共 10 人，总价 260 元。成人有几人？', type: 'numeric', answerNum: 6 },
  { id: '7-h-1', skill: 7, difficulty: 3, prompt: '甲乙两人同时做工，甲每小时 x 件，乙每小时 2 件，5 小时做 20 件。求 x。', type: 'numeric', answerNum: 2 },
  // 2nd set
  { id: '1-e-2', skill: 1, difficulty: 1, prompt: '向东为正方向，向西为负方向。向西走 4 步表示为？', type: 'numeric', answerNum: -4 },
  { id: '1-m-2', skill: 1, difficulty: 2, prompt: '比较 -7 与 -2 的大小，输入较大的数。', type: 'numeric', answerNum: -2 },
  { id: '1-h-2', skill: 1, difficulty: 3, prompt: '绝对值相等的数：-x 与 x，哪个更大？若 x < 0 输入较大者。', type: 'expr', answer: ['-x'] },
  { id: '2-e-2', skill: 2, difficulty: 1, prompt: '计算 3/5 - 1/5 的值。', type: 'numeric', answerNum: 2/5 },
  { id: '2-m-2', skill: 2, difficulty: 2, prompt: '计算 (-1.2) + 0.7 的值。', type: 'numeric', answerNum: -0.5 },
  { id: '2-h-2', skill: 2, difficulty: 3, prompt: '计算 (-3/4) × (2/3) 的值。', type: 'numeric', answerNum: -1/2 },
  { id: '3-e-2', skill: 3, difficulty: 1, prompt: '用字母表示：m 的一半。', type: 'expr', answer: ['m/2', '1/2m', '0.5m'] },
  { id: '3-m-2', skill: 3, difficulty: 2, prompt: '用字母表示：a的3倍加上7。', type: 'expr', answer: ['3a+7'] },
  { id: '3-h-2', skill: 3, difficulty: 3, prompt: '化成等价表达式：b(b-1)+b。', type: 'expr', answer: ['b^2', 'b*b'] },
  { id: '4-e-2', skill: 4, difficulty: 1, prompt: '化简：4y - y。', type: 'expr', answers: ['3y'] },
  { id: '4-m-2', skill: 4, difficulty: 2, prompt: '化简：2a^2 + a^2 - 3a。', type: 'expr', answers: ['3a^2-3a'] },
  { id: '4-h-2', skill: 4, difficulty: 3, prompt: '化简：(x+1)(x-1)。', type: 'expr', answers: ['x^2-1'] },
  { id: '5-e-2', skill: 5, difficulty: 1, prompt: '解方程：x - 9 = 4。求 x。', type: 'numeric', answerNum: 13 },
  { id: '5-m-2', skill: 5, difficulty: 2, prompt: '解方程：3x + 6 = 0。求 x。', type: 'numeric', answerNum: -2 },
  { id: '5-h-2', skill: 5, difficulty: 3, prompt: '解方程：5x - (x - 2) = 10。求 x。', type: 'numeric', answerNum: 2 },
  // 3rd set
  { id: '1-e-3', skill: 1, difficulty: 1, prompt: '海拔下降 8 米，应该表示为？', type: 'numeric', answerNum: -8 },
  { id: '1-m-3', skill: 1, difficulty: 2, prompt: '比较 -1 与 -5 的大小，输入较大的数。', type: 'numeric', answerNum: -1 },
  { id: '1-h-3', skill: 1, difficulty: 3, prompt: '绝对值相等的数：-x 与 x，哪个更大？若 x<0 输入较大者。', type: 'expr', answerNum: 'x' },
  { id: '2-e-3', skill: 2, difficulty: 1, prompt: '计算 2/3 - 1/6。', type: 'numeric', answerNum: 1/2 },
  { id: '2-m-3', skill: 2, difficulty: 2, prompt: '计算 (-2/5) + 3/10。', type: 'numeric', answerNum: -1/10 },
  { id: '2-h-3', skill: 2, difficulty: 3, prompt: '计算 (-1.5) × 2/3。', type: 'numeric', answerNum: -1 },
  { id: '3-e-3', skill: 3, difficulty: 1, prompt: '用字母表示：一个数 t 减去 4。', type: 'expr', answers: ['t-4', 't+(-4)'] },
  { id: '3-m-3', skill: 3, difficulty: 2, prompt: '用字母表示：p 的 2 倍加上 3。', type: 'expr', answers: ['2p+3', '2*p+3'] },
  { id: '3-h-3', skill: 3, difficulty: 3, prompt: '化成等价表达式：x(x+2) - x。', type: 'expr', answers: ['x^2+x', 'x*(x+1)'] },
  { id: '4-e-3', skill: 4, difficulty: 1, prompt: '化简：5a - 2a。', type: 'expr', answers: ['3a'] },
  { id: '4-m-3', skill: 4, difficulty: 2, prompt: '化简：2x^2 + 3x - x^2。', type: 'expr', answers: ['x^2+3x'] },
  { id: '4-h-3', skill: 4, difficulty: 3, prompt: '化简：(2x+1)(x-1)。', type: 'expr', answers: ['2x^2-x-1'] },
  { id: '5-e-3', skill: 5, difficulty: 1, prompt: '解方程：x - 4 = 9。求 x。', type: 'numeric', answerNum: 13 },
  { id: '5-m-3', skill: 5, difficulty: 2, prompt: '解方程：3x + 2 = 11。求 x。', type: 'numeric', answerNum: 3 },
  { id: '5-h-3', skill: 5, difficulty: 3, prompt: '解方程：2(x - 3) + 4 = 0。求 x。', type: 'numeric', answerNum: 1 },
  { id: '6-e-3', skill: 6, difficulty: 1, prompt: '解方程组：x + y = 7，x - y = 3。求 x。', type: 'numeric', answerNum: 5 },
  { id: '6-m-3', skill: 6, difficulty: 2, prompt: '解方程组：x + 2y = 10，2x - y = 4。求 x。', type: 'numeric', answerNum: 18/5 },
  { id: '6-h-3', skill: 6, difficulty: 3, prompt: '解方程组：3x + 2y = 13，x - y = 1。求 x。', type: 'numeric', answerNum: 3 },
  { id: '7-e-3', skill: 7, difficulty: 1, prompt: '一支笔 3 元，一本本子 2 元，共买 5 件，花 12 元。笔几支？', type: 'numeric', answerNum: 2 },
  { id: '7-m-3', skill: 7, difficulty: 2, prompt: '甲比乙多 4 个，甲乙共 26 个。甲有几个？', type: 'numeric', answerNum: 15 },
  { id: '7-h-3', skill: 7, difficulty: 3, prompt: '两人合作：甲每小时 a 件，乙每小时 3 件，4 小时共 20 件。求 a。', type: 'numeric', answerNum: 2 },
  // 4th set
  { id: '1-e-4', skill: 1, difficulty: 1, prompt: '零下 12 度表示为？', type: 'numeric', answerNum: -12 },
  { id: '1-m-4', skill: 1, difficulty: 2, prompt: '比较 -9 与 -4 的大小，输入较大的数。', type: 'numeric', answerNum: -4 },
  { id: '1-h-4', skill: 1, difficulty: 3, prompt: '一个数与它的相反数之差为 10，求这个数。', type: 'numeric', answerNum: 5 },
  { id: '2-e-4', skill: 2, difficulty: 1, prompt: '计算 1/4 + 1/2。', type: 'numeric', answerNum: 3/4 },
  { id: '2-m-4', skill: 2, difficulty: 2, prompt: '计算 (-0.6) - 0.9。', type: 'numeric', answerNum: -1.5 },
  { id: '2-h-4', skill: 2, difficulty: 3, prompt: '计算 (-5/6) × (-3/10)。', type: 'numeric', answerNum: 1/4 },
  { id: '3-e-4', skill: 3, difficulty: 1, prompt: '用字母表示：一个数 n 的 3 倍。', type: 'expr', answers: ['3n', 'n*3'] },
  { id: '3-m-4', skill: 3, difficulty: 2, prompt: '用字母表示：k 的 5 倍减去 8。', type: 'expr', answers: ['5k-8', '5*k-8'] },
  { id: '3-h-4', skill: 3, difficulty: 3, prompt: '化简：a(a+3) - a。', type: 'expr', answers: ['a^2+2a', 'a*(a+2)'] },
  { id: '4-e-4', skill: 4, difficulty: 1, prompt: '化简：6x + 4x。', type: 'expr', answers: ['10x'] },
  { id: '4-m-4', skill: 4, difficulty: 2, prompt: '化简：3a^2 + 2a - a^2 + a。', type: 'expr', answers: ['2a^2+3a'] },
  { id: '4-h-4', skill: 4, difficulty: 3, prompt: '化简：(x+2)(x+3)。', type: 'expr', answers: ['x^2+5x+6'] },
  { id: '5-e-4', skill: 5, difficulty: 1, prompt: '解方程：x + 6 = 15。求 x。', type: 'numeric', answerNum: 9 },
  { id: '5-m-4', skill: 5, difficulty: 2, prompt: '解方程：4x - 8 = 12。求 x。', type: 'numeric', answerNum: 5 },
  { id: '5-h-4', skill: 5, difficulty: 3, prompt: '解方程：2(x + 1) = 10。求 x。', type: 'numeric', answerNum: 4 },
  { id: '6-e-4', skill: 6, difficulty: 1, prompt: '解方程组：x + y = 8，x - y = 4。求 x。', type: 'numeric', answerNum: 6 },
  { id: '6-m-4', skill: 6, difficulty: 2, prompt: '解方程组：2x + y = 9，x + y = 6。求 x。', type: 'numeric', answerNum: 3 },
  { id: '6-h-4', skill: 6, difficulty: 3, prompt: '解方程组：2x - y = 3，x + 2y = 8。求 x。', type: 'numeric', answerNum: 14/5 },
  { id: '7-e-4', skill: 7, difficulty: 1, prompt: '每分钟走 60 米，走 300 米需要几分钟？', type: 'numeric', answerNum: 5 },
  { id: '7-m-4', skill: 7, difficulty: 2, prompt: '成人票 40 元，儿童票 25 元，共 10 张，总价 325 元。成人有几张？', type: 'numeric', answerNum: 5 },
  { id: '7-h-4', skill: 7, difficulty: 3, prompt: '甲每小时 4 件，乙每小时 b 件，3 小时共 21 件。求 b。', type: 'numeric', answerNum: 3 },
  // 5th set
  { id: '1-e-5', skill: 1, difficulty: 1, prompt: '温度从 0 降到 -7 度，表示为？', type: 'numeric', answerNum: -7 },
  { id: '1-m-5', skill: 1, difficulty: 2, prompt: '比较 -2 与 0 的大小，输入较大的数。', type: 'numeric', answerNum: 0 },
  { id: '1-h-5', skill: 1, difficulty: 3, prompt: '若 |x| = 4 且 x < 0，求 x。', type: 'numeric', answerNum: -4 },
  { id: '2-e-5', skill: 2, difficulty: 1, prompt: '计算 1/3 + 1/6。', type: 'numeric', answerNum: 1/2 },
  { id: '2-m-5', skill: 2, difficulty: 2, prompt: '计算 (-2/3) + 5/6。', type: 'numeric', answerNum: 1/6 },
  { id: '2-h-5', skill: 2, difficulty: 3, prompt: '计算 (-1.2) × (-0.5)。', type: 'numeric', answerNum: 0.6 },
  { id: '3-e-5', skill: 3, difficulty: 1, prompt: '用字母表示：一个数 p 的 4 倍。', type: 'expr', answers: ['4p', 'p*4'] },
  { id: '3-m-5', skill: 3, difficulty: 2, prompt: '用字母表示：q 的 2 倍加上 9。', type: 'expr', answers: ['2q+9', '2*q+9'] },
  { id: '3-h-5', skill: 3, difficulty: 3, prompt: '化成等价表达式：m(m-1) + m。', type: 'expr', answers: ['m^2', 'm*m'] },
  { id: '4-e-5', skill: 4, difficulty: 1, prompt: '化简：7y - 2y。', type: 'expr', answers: ['5y'] },
  { id: '4-m-5', skill: 4, difficulty: 2, prompt: '化简：x^2 + 4x - 2x^2 + x。', type: 'expr', answers: ['-x^2+5x'] },
  { id: '4-h-5', skill: 4, difficulty: 3, prompt: '化简：(x-2)(x+2)。', type: 'expr', answers: ['x^2-4'] },
  { id: '5-e-5', skill: 5, difficulty: 1, prompt: '解方程：x - 3 = 10。求 x。', type: 'numeric', answerNum: 13 },
  { id: '5-m-5', skill: 5, difficulty: 2, prompt: '解方程：5x + 5 = 0。求 x。', type: 'numeric', answerNum: -1 },
  { id: '5-h-5', skill: 5, difficulty: 3, prompt: '解方程：2(x - 4) = 6。求 x。', type: 'numeric', answerNum: 7 },
  { id: '6-e-5', skill: 6, difficulty: 1, prompt: '解方程组：x + y = 9，x - y = 1。求 x。', type: 'numeric', answerNum: 5 },
  { id: '6-m-5', skill: 6, difficulty: 2, prompt: '解方程组：3x + y = 10，x + y = 6。求 x。', type: 'numeric', answerNum: 2 },
  { id: '6-h-5', skill: 6, difficulty: 3, prompt: '解方程组：2x + 3y = 12，x - y = 1。求 x。', type: 'numeric', answerNum: 3 },
  { id: '7-e-5', skill: 7, difficulty: 1, prompt: '每分钟走 50 米，走 200 米需要几分钟？', type: 'numeric', answerNum: 4 },
  { id: '7-m-5', skill: 7, difficulty: 2, prompt: '成人票 50 元，儿童票 30 元，共 10 张，总价 380 元。成人有几张？', type: 'numeric', answerNum: 4 },
  { id: '7-h-5', skill: 7, difficulty: 3, prompt: '甲每小时 3 件，乙每小时 c 件，5 小时共 40 件。求 c。', type: 'numeric', answerNum: 5 }
];

function renderRow(q) {
  const expListRaw = q.answers || q.answer || [];
  const expList = Array.isArray(expListRaw) ? expListRaw : [expListRaw];
  const expText = q.type === 'numeric' ? String(q.answerNum) : expList.join(' / ');
  // Try to extract TeX expression from prompt for expr
  let promptHTML = q.prompt;
  if (q.type === 'expr') {
    const cleaned = (q.prompt || '').replace(/。$/, '');
    const parts = cleaned.split('：');
    if (parts.length === 2) {
      promptHTML = `<div>${parts[0]}：</div><div class="expr-tex">\\(${parts[1]}\\)</div>`;
    } else {
      promptHTML = `<div>${q.prompt}</div>`;
    }
  }
  const tr = document.createElement('tr');
  tr.innerHTML = `
    <td>${q.id}</td>
    <td>${SKILL_NAMES[q.skill] || q.skill}</td>
    <td>${DIFF_LABEL[q.difficulty] || q.difficulty}</td>
    <td>${promptHTML}</td>
    <td>${q.type}</td>
    <td>${expText}</td>
    <td>
      <input type="text" class="teacher-input" data-id="${q.id}" placeholder="输入答案" />
      <button class="test-btn" data-id="${q.id}">测试</button>
    </td>
    <td class="result" data-id="${q.id}"></td>
  `;
  return tr;
}

function populateTable() {
  const tbody = document.getElementById('questions-tbody');
  tbody.innerHTML = '';
  QUESTIONS.forEach(q => tbody.appendChild(renderRow(q)));
  if (window.MathJax && typeof window.MathJax.typesetPromise === 'function') {
    window.MathJax.typesetPromise([document.getElementById('questions-table')]).catch(console.error);
  }
}

function bindRowEvents() {
  document.querySelectorAll('.test-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const id = btn.getAttribute('data-id');
      const q = QUESTIONS.find(qq => qq.id === id);
      const input = document.querySelector(`.teacher-input[data-id="${id}"]`);
      const resEl = document.querySelector(`.result[data-id="${id}"]`);
      if (!q || !input || !resEl) return;
      const val = input.value || '';
      if (q.type === 'numeric' && typeof q.answerNum !== 'number') {
        resEl.innerHTML = `<span class="warn">数据问题：numeric题答案非数值 (${String(q.answerNum)})</span>`;
        return;
      }
      const r = evaluate(val, q);
      if (r.ok) {
        resEl.innerHTML = `<span class="ok">正确 / Correct</span>`;
      } else {
        const expRaw = q.type === 'numeric' ? String(q.answerNum) : (q.answers || q.answer || []).toString();
        resEl.innerHTML = `<span class="fail">错误 / Wrong</span><div class="small">期望: ${expRaw}</div>`;
      }
    });
  });
}

function autoVerifyAll() {
  let total = QUESTIONS.length;
  let pass = 0; let fail = 0; let warn = 0;
  QUESTIONS.forEach(q => {
    const resEl = document.querySelector(`.result[data-id="${q.id}"]`);
    if (q.type === 'numeric' && typeof q.answerNum !== 'number') {
      warn++;
      if (resEl) resEl.innerHTML = `<span class="warn">数据问题：numeric题答案非数值 (${String(q.answerNum)})</span>`;
      return;
    }
    if (q.type === 'numeric') {
      const r = evaluate(String(q.answerNum), q);
      if (r.ok) { pass++; if (resEl) resEl.innerHTML = `<span class="ok">自动验证通过</span>`; }
      else { fail++; if (resEl) resEl.innerHTML = `<span class="fail">自动验证失败</span>`; }
    } else {
      const expListRaw = q.answers || q.answer || [];
      const expList = Array.isArray(expListRaw) ? expListRaw : [expListRaw];
      let anyOk = false;
      for (const ans of expList) {
        const r = evaluate(ans, q);
        if (r.ok) { anyOk = true; break; }
      }
      if (anyOk) { pass++; if (resEl) resEl.innerHTML = `<span class="ok">自动验证通过</span>`; }
      else { fail++; if (resEl) resEl.innerHTML = `<span class="fail">自动验证失败</span>`; }
    }
  });
  const sumEl = document.getElementById('summary');
  sumEl.textContent = `总题数: ${total} | 通过: ${pass} | 失败: ${fail} | 数据警告: ${warn}`;
}

populateTable();
bindRowEvents();

document.getElementById('auto-check-btn').addEventListener('click', autoVerifyAll);
</script>
</body>
</html>